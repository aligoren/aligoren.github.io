<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content=".NET, SQL, Python, Açık Kaynak">

    <title>Flask ile JSON Çıktı Almak - Ali GÖREN...</title>

    <link rel="canonical" href="https://aligoren.comhttps://aligoren.com/flask-ile-json-cikti-almak">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://aligoren.com/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://aligoren.com/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <!-- <link rel="stylesheet" href="https://aligoren.com/css/syntax.css"> -->
    <link rel="stylesheet" href="https://aligoren.com/css/prism.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://aligoren.com/feed.xml" title="Ali GÖREN..." />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://aligoren.com/">Ali GÖREN...</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://aligoren.com/">Anasayfa</a>
                </li>
                
				
                
				
                <li>
                    <a href="https://aligoren.com/hakkimda">Hakkımda</a>
                </li>
				
                
				
                <li>
                    <a href="https://aligoren.com/kategoriler">Kategoriler</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('https://aligoren.com/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1 class="yazibasligi">Flask ile JSON Çıktı Almak</h1>
                    
                    <!--<span class="meta">Posted by Ali GÖREN... on April 3, 2016</span>-->
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 yaziici">

				<p>Flask framework’ü bilmeyen yoktur. Bu yazı hiç kullanmamış arkadaşlar için değil baştan belirteyim. Bu yazıda Flask framework ile nasıl json çıktı alırız onu anlatmaya çalışacağım.</p>

<p>Öncelikle flask kurulu olmalı onu biliyoruz. json çıktı alma işlemi için ben flask ile gelen jsonify metodunu tercih ediyorum. Siz isterseniz klasik json da kullanabilirsiniz. İki türlü de aynı çalışıyor. Sadece jsonify çıktıları biraz daha güzel gösteriyor. Ben bu yazı için hazırladığım uygulamada işi biraz farklı bir noktaya taşıdım ve sanki bir api varmış gibi çalışsın istedim.</p>

<p>Bunun için bir API_KEY oluşturulmalı. Ben api key için uuid kullandım. Vereceğim kod parçasını sakın referans olarak almayın. Değişik bir api oluşturma kafasına sahiptim o sıra. Neyse api key oluşturma işlevi şöyle:</p>

<pre><code class="language-python">import uuid
import random
import hashlib

def generate_key(user_name):
    uname_comp = hashlib.md5(user_name.encode()).hexdigest()
    g_key = uuid.uuid5(uuid.NAMESPACE_DNS,
                       (uname_comp + user_name + 'api_gen'))
    gt_key = str(g_key)
    gt_key = gt_key.replace("-", "")

    i_key = uuid.uuid5(uuid.NAMESPACE_DNS, (uname_comp + '127.0.0.1'))
    ip_key = str(i_key)
    ip_key = ip_key.replace("-", "")

    p_key = uuid.uuid5(uuid.NAMESPACE_X500,
                       (uname_comp + 'python' + uname_comp))
    py_key = str(p_key)
    py_key = py_key.replace("-", "")

    flsk_key = uuid.uuid5(uuid.NAMESPACE_URL, ('flask' + uname_comp))
    flk_key = str(flsk_key)
    flk_key = flk_key.replace("-", "")

    now_key = ip_key + gt_key + py_key + flk_key

    rt_key = uuid.uuid5(uuid.NAMESPACE_DNS,
                        (uname_comp + now_key + uname_comp + uname_comp))
    rtn_key = str(rt_key)
    rtn_key = rtn_key.replace("-", "")
    return rtn_key
</code></pre>

<p>Kod kötü bi pratik olduğu için değişken isimlerini vs. değiştirmedim önemli gelmedi bana sonuçta bu yazıya hazırlıyorum. Muhtemelen api key oluşturmanın daha mükemmel yolları var. Efendim gelelim Bu <code>generate_key</code> işlevi ile oluşturacağımız key’lere. Kullanımı basit tek bi argüman alıyor o da user_name. Bu argüman kullanıcı kayıt olduğu anda gelen argüman olarak oluştu diyelim. Şöyle kullanalım</p>

<pre><code class="language-python">print(generate_key("admin"))
# "a21aacf74f79519b85581b87b8583f13"
</code></pre>

<p>Çıktı olarak buna benzer 32 karakterden oluşan bi string üretilmiş oldu. Şimdi bu api_key işlemi tamam. Bu yazı için rastgele sözler uygulaması hazırladım. Sözleri author’a göre çekecek. Herhangi bir veritabanı kullanmadım. Basit bi dictionary’den oluşuyor. O zaman author’a göre çekecekse ve api key ile olacaksa URL yapısını şöyle düşündüm:</p>

<p><code>http://site.dev:5000/quote/author=&lt;author&gt;&amp;api_key=&lt;api_key&gt;</code></p>

<p>URL’den de anlaşılacağı gibi route, quote olarak ayarlanmış durumda.</p>

<pre><code class="language-python">@app.route('/quote/author=&lt;author&gt;&amp;api_key=&lt;api_key&gt;')
</code></pre>

<p>Artık bu route için oluşturacağımız metod iki argüman alacak. Birisi author diğeri ise api_key argümanı olacak.</p>

<pre><code class="language-python">def quoteing(api_key, author):
    key_list = ["2bd137ea90b45b8b8902a39b6b192936",
                "3b2b6e8152475891a39297e331e8ad52",
                "26fec42ede2057ae84ed6514be7823c6",
                "a21aacf74f79519b85581b87b8583f13",
                "6968a8489e495d12976eaf25ba860423"]
</code></pre>

<p>Route için oluşturduğum işlev burada. Adına bakmayın :p. Burada key_list kısmını ben yukarıdaki generate_key işlevi ile oluşturdum. Bunlar statik keyler. Daha sonra ise işlevin aldığı argüman bu liste içinde var mı yok mu şeklinde kontrol edeceğiz:</p>

<pre><code class="language-python">harfler = {'İ': 'i', 'Ö': 'o', 'I': 'i', 'ı': 'i',
           'Ç': 'c', 'Ğ': 'g', 'Ş': 's', 'Ü': 'u',
           'ü': 'u', 'ö': 'o', 'ş': 's', 'ç': 'c',
           'ğ': 'g'
           }


def karakter(metin, sozluk):
    for i, j in sozluk.items():
        metin = metin.replace(i, j)
    return metin

if api_key in key_list:
    quotes = {'ataturk':
              ['Hayatta En Hakiki Mursit Ilimdir Fendir',
               'Bagimsizlik, ugruna olmesini bilen toplumlarin hakkidir.'],
              'mahatma gandhi':
              ['Happiness is when what you think, what you'
               'say,and what you do are in harmony.',
               'Guc fiziki kapasiteden degil,'
               'boyun egmeyen iradeden gelir.']}

    get_quote = quotes[karakter(author.lower(), harfler)]
</code></pre>

<p>Buradaki quotes bir sözlük yani dict olduğu için key-value şeklinde çalışıyor. Biz key değerini girerek value çekebiliriz. İçeride yer alan bir karakter işlevi. Türkçe karakter sorunu yaşanıyorsa kullanılabilir. Benim url yapımda örneğin <code>/quote/author=Atatürk&amp;api_key=&lt;api_key&gt;</code> şeklinde bir author çağrısında yani aslında key çağrısında karakterden dolayı sorun yaşıyordum. Onu hallettim denilebilir.</p>

<p>Daha sonra ise artık bu değerleri döndürmemiz gerekiyor. api key var mı yok mu kontrolü ile birlikte olacak şekilde. Burada jsonify işlevi direkt olarak dict alabiliyor. Yani herhangi bir değişkene ilklemenize gerek yok aslında. Sol değer key, sağ değer ise value gibi bir çıktı verecektir.</p>

<pre><code class="language-python">    return jsonify(quotes=random.choice(get_quote))
else:
    return jsonify(error="API Key Not Found")
</code></pre>

<p>Son olarak da parametrelerden birisi girilmezse 404 hatası yerine yine json çıktısı üretelim:</p>

<pre><code class="language-python">@app.errorhandler(404)
def exception_handler(e):
    return jsonify(error="404 Not Found")
</code></pre>

<p>Bu sayede 404 olacak hatalarda json haliyle çıkmış olacak. Şimdi hazırladığımız uygulamayı bi çalıştıralım ve bakalım. Öncelikle konsolda <code>a21aacf74f79519b85581b87b8583f13</code> şeklinde bir çıktı var. O generate_key işlevi ile ürettiğimiz bir çıktı bunu biliyoruz. <code>http://127.0.0.1:5000/</code> adresini açarsak eğer error anahtarlı bir uyarı göreceğiz yine çıktısı json:</p>

<pre><code class="language-json">{
  "error": "404 Not Found"
}
</code></pre>

<p>O zaman quote url’sine yönlenelim. URL şöyle olacak <code>http://127.0.0.1:5000/quote/</code>. Bu kısma gelince ufak bi manual tarzı şey hazırlamıştım. Onu göreceğiz:</p>

<pre><code class="language-json">{
  "USER_API_KEY": [
    "2bd137ea90b45b8b8902a39b6b192936",
    "3b2b6e8152475891a39297e331e8ad52",
    "26fec42ede2057ae84ed6514be7823c6",
    "a21aacf74f79519b85581b87b8583f13",
    "6968a8489e495d12976eaf25ba860423"
  ],
  "error": "API Key Required",
  "url_example": "/quote/author=ATATURK&amp;api_key=API_KEY_HERE"
}
</code></pre>

<p>Biz de url_example üzerinden listedeki örnek api keyleri kullanarak gidelim. Adres yapısını şöyle seçtim <code>http://127.0.0.1:5000/quote/author=atatürk&amp;api_key=a21aacf74f79519b85581b87b8583f13</code>. Bu haliyle şu çıktıyı veriyor:</p>

<pre><code class="language-json">{
  "quotes": "Hayatta En Hakiki Mursit Ilimdir Fendir"
}
</code></pre>

<p>Sayfayı yeniledikçe hangi sözler var ise rastgele onu çekecek. Bizim örnekte iki tane vardı. Peki hatalı bir API girseydik? Örneğin şöyle <code>http://127.0.0.1:5000/quote/author=atatürk&amp;api_key=interesting_api</code>. Çıktısı şöyle olacaktı:</p>

<pre><code class="language-json">{
  "error": "API Key Not Found"
}
</code></pre>

<p>Son olarak değer girilmezse şöyle olacak. URL örneğin <code>http://127.0.0.1:5000/quote/author=atatürk&amp;api_key=</code></p>

<pre><code class="language-json">{
  "error": "404 Not Found"
}
</code></pre>

<h1 id="kodların-tamamı">Kodların Tamamı</h1>

<pre><code class="language-python">from flask import Flask, jsonify
import uuid
import random
import hashlib


app = Flask(__name__)


def generate_key(user_name):
    uname_comp = hashlib.md5(user_name.encode()).hexdigest()
    g_key = uuid.uuid5(uuid.NAMESPACE_DNS,
                       (uname_comp + user_name + 'api_gen'))
    gt_key = str(g_key)
    gt_key = gt_key.replace("-", "")

    i_key = uuid.uuid5(uuid.NAMESPACE_DNS, (uname_comp + '127.0.0.1'))
    ip_key = str(i_key)
    ip_key = ip_key.replace("-", "")

    p_key = uuid.uuid5(uuid.NAMESPACE_X500,
                       (uname_comp + 'python' + uname_comp))
    py_key = str(p_key)
    py_key = py_key.replace("-", "")

    flsk_key = uuid.uuid5(uuid.NAMESPACE_URL, ('flask' + uname_comp))
    flk_key = str(flsk_key)
    flk_key = flk_key.replace("-", "")

    now_key = ip_key + gt_key + py_key + flk_key

    rt_key = uuid.uuid5(uuid.NAMESPACE_DNS,
                        (uname_comp + now_key + uname_comp + uname_comp))
    rtn_key = str(rt_key)
    rtn_key = rtn_key.replace("-", "")
    return rtn_key

print(generate_key("admin"))

harfler = {'İ': 'i', 'Ö': 'o', 'I': 'i', 'ı': 'i',
           'Ç': 'c', 'Ğ': 'g', 'Ş': 's', 'Ü': 'u',
           'ü': 'u', 'ö': 'o', 'ş': 's', 'ç': 'c',
           'ğ': 'g'
           }


def karakter(metin, sozluk):
    for i, j in sozluk.items():
        metin = metin.replace(i, j)
    return metin


@app.route('/quote/')
def quote_index():
    url_type = '/quote/author=ATATURK&amp;api_key=API_KEY_HERE'

    key_list = ["2bd137ea90b45b8b8902a39b6b192936",
                "3b2b6e8152475891a39297e331e8ad52",
                "26fec42ede2057ae84ed6514be7823c6",
                "a21aacf74f79519b85581b87b8583f13",
                "6968a8489e495d12976eaf25ba860423"]

    return jsonify(error="API Key Required", url_example=url_type,
                   USER_API_KEY=key_list)


@app.route("/quote/author=&lt;author&gt;&amp;api_key=&lt;api_key&gt;")
def quoteing(api_key, author):
    key_list = ["2bd137ea90b45b8b8902a39b6b192936",
                "3b2b6e8152475891a39297e331e8ad52",
                "26fec42ede2057ae84ed6514be7823c6",
                "a21aacf74f79519b85581b87b8583f13",
                "6968a8489e495d12976eaf25ba860423"]

    if api_key in key_list:
        quotes = {'ataturk':
                  ['Hayatta En Hakiki Mursit Ilimdir Fendir',
                   'Bagimsizlik, ugruna olmesini bilen toplumlarin hakkidir.'],
                  'mahatma gandhi':
                  ['Happiness is when what you think, what you'
                   'say,and what you do are in harmony.',
                   'Guc fiziki kapasiteden degil,'
                   'boyun egmeyen iradeden gelir.']}

        get_quote = quotes[karakter(author.lower(), harfler)]

        return jsonify(quotes=random.choice(get_quote))
    else:
        return jsonify(error="API Key Not Found")


@app.errorhandler(404)
def exception_handler(e):
    return jsonify(error="404 Not Found")

if __name__ == "__main__":
    # app.debug = True
    app.run()
</code></pre>

<p>Eğer <code>app.debug = True</code> yaparsanız live olarak çalışırsınız. Yenileme yaptığınız zaman değişiklikler anında uygulanır tekrardan başlatmanıza gerek kalmaz. Evet bu kadar. Hatalı noktalarım varsa şimdiden özür dilerim.</p>


                <hr>
                
                  <div id="disqus_thread"></div>
                  <script type="text/javascript">
                    var disqus_shortname  = 'aligren';
                    var disqus_identifier = '/flask-ile-json-cikti-almak';
                    var disqus_title      = "Flask ile JSON Çıktı Almak";

                    (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                  </script>
                  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                  <hr>
                
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="https:/aligoren.com/pythonda-zincirleme-metodlar" data-toggle="tooltip" data-placement="top" title="Python'da Zincirleme Metodlar">&larr; Sonraki Yazı</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="https:/aligoren.com/python-ve-ngram-algoritmasi" data-toggle="tooltip" data-placement="top" title="Python ve NGram Algoritması">Önceki Yazı &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://aligoren.com/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/aligoren">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:goren.ali@yandex.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy;  2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="https://aligoren.com/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://aligoren.com/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="https://aligoren.com/js/clean-blog.min.js "></script>
<script src="https://aligoren.com/js/prism.js "></script>


    


</body>

</html>
